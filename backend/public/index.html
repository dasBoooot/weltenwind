<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weltenwind ARB Manager</title>
    <link rel="stylesheet" href="arb.css">
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <h1>ğŸŒ Weltenwind ARB Manager</h1>
        <p>Admin-Login erforderlich</p>
        <div id="loginError" class="error hidden"></div>
        <form id="loginForm">
            <div>
                <input type="text" id="username" placeholder="Username oder E-Mail" required>
            </div>
            <div>
                <input type="password" id="password" placeholder="Password" required>
            </div>
            <div>
                <button type="submit" id="loginButton">ğŸ”“ Anmelden</button>
            </div>
        </form>
    </div>

    <!-- ARB Manager (hidden initially) -->
    <div id="arbManager" class="hidden">
        <h1>ğŸŒ Weltenwind ARB Manager</h1>
        <div style="float: right;">
            <span id="userInfo"></span>
            <button onclick="logout()">ğŸšª Abmelden</button>
        </div>

        <div class="language-info">
            <h3 id="currentLanguageTitle">ğŸŒ ARB-Sprache</h3>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="keyCount">-</div>
                    <div class="stat-label">EintrÃ¤ge</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="lastModified">-</div>
                    <div class="stat-label">Zuletzt geÃ¤ndert</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="toolbar">
                <div class="search-box">
                    <input type="text" id="searchBox" placeholder="ğŸ” Suche nach SchlÃ¼ssel oder Text..." onkeyup="filterEntries()">
                </div>
                <div style="margin-right: 15px;">
                    <select id="contextFilter" onchange="filterEntries()">
                        <option value="">ğŸ·ï¸ Alle Kontexte</option>
                    </select>
                </div>
                <div>
                    <select id="languageSelector" onchange="loadSelectedLanguage()">
                        <option value="">ğŸŒ Sprache wÃ¤hlen...</option>
                    </select>
                    <button class="btn-success" onclick="showSaveConfirmDialog()" id="saveButton">ğŸ’¾ Speichern</button>
                <button class="btn-secondary" onclick="showBackupDialog()" id="backupButton" disabled title="Backup-Versionen verwalten">ğŸ—‚ï¸ Backups</button>
                    <button onclick="toggleCompareView()" id="compareButton">ğŸ“Š Vergleichsansicht</button>
                    <button class="btn-secondary" onclick="showExportDialog()" id="exportButton">ğŸ“¤ Exportieren</button>
                    <button class="btn-secondary" onclick="showImportDialog()" id="importButton">ğŸ“¥ Importieren</button>
                </div>
            </div>
        </div>

        <div id="arbContainer" class="arb-container">
            <div class="loading">
                <div class="spinner"></div>
                <div>Lade deutsche ARB-EintrÃ¤ge...</div>
            </div>
        </div>

        <div id="arbMessage" class="hidden"></div>

        <!-- Multi-Language Compare View -->
        <div id="compareContainer" class="compare-container hidden">
            <!-- Compare Header with Statistics -->
            <div class="compare-header">
                <div class="compare-title">
                    <h3>ğŸ“Š Multi-Language Vergleichsansicht</h3>
                    <button class="btn-secondary" onclick="toggleCompareView()">â¬…ï¸ ZurÃ¼ck zur Einzelansicht</button>
                </div>
                
                <div class="compare-stats">
                    <div class="stat-group">
                        <div class="stat-item">
                            <span class="stat-value" id="compareLanguageCount">-</span>
                            <span class="stat-label">Sprachen</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="compareTotalKeys">-</span>
                            <span class="stat-label">Master-Keys</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="compareAvgCompleteness">-</span>
                            <span class="stat-label">Ã˜ VollstÃ¤ndigkeit</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="compareMissingLanguages">-</span>
                            <span class="stat-label">mit fehlenden Keys</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compare Filters -->
            <div class="compare-filters">
                <div class="filter-group">
                    <label>ğŸ¯ Vergleiche:</label>
                    <select id="compareTargetLanguage" onchange="updateCompareView()">
                        <option value="">Zielsprache wÃ¤hlen...</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ğŸ” Filter:</label>
                    <select id="compareKeyFilter" onchange="filterCompareEntries()">
                        <option value="all">Alle Keys anzeigen</option>
                        <option value="missing">Fehlt in Zielsprache</option>
                        <option value="complete">In beiden vorhanden</option>
                        <option value="incomplete">Nur in Deutsch vorhanden</option>
                    </select>
                </div>
                <div class="filter-group">
                    <input type="text" id="compareSearchBox" placeholder="ğŸ” Suche nach Key oder Text..." onkeyup="filterCompareEntries()">
                </div>
            </div>

            <!-- Language Report Cards -->
            <div class="language-reports">
                <div id="languageReportCards" class="report-cards">
                    <!-- Language report cards will be populated here -->
                </div>
            </div>

            <!-- Compare Table -->
            <div class="compare-table-container">
                <div class="compare-loading">
                    <div class="spinner"></div>
                    <div>Lade Multi-Language Vergleich...</div>
                </div>
                
                <table id="compareTable" class="compare-table hidden">
                    <thead>
                        <tr id="compareTableHeader">
                            <!-- Table headers will be populated dynamically -->
                        </tr>
                    </thead>
                    <tbody id="compareTableBody">
                        <!-- Table rows will be populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Export Dialog -->
    <div id="exportDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ“¤ ARB-Daten exportieren</h3>
                <p>WÃ¤hle das Format fÃ¼r den Export:</p>
                
                <div class="export-options">
                    <button class="btn-success" onclick="exportARB('arb')">
                        ğŸ“„ .arb Format<br>
                        <small>Flutter ARB-Datei</small>
                    </button>
                    <button class="btn-success" onclick="exportARB('json')">
                        ğŸ“‹ .json Format<br>
                        <small>Strukturierte JSON-Daten</small>
                    </button>
                </div>
                
                <div class="export-info">
                    <strong>Exportiert werden:</strong>
                    <ul>
                        <li id="exportKeyCount">- Keys</li>
                        <li>Alle Ãœbersetzungen und Metadaten</li>
                        <li>Aktuelle Filterung wird ignoriert</li>
                    </ul>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeExportDialog()">âŒ Abbrechen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Management Dialog -->
    <div id="backupDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content backup-dialog">
                <h3>ğŸ—‚ï¸ ARB-Backup-Historie</h3>
                <p><strong>ğŸŒ Sprache:</strong> <span id="backupLanguageName">-</span></p>
                
                <div class="backup-filters">
                    <button class="filter-btn active" onclick="filterARBBackups('all')">Alle</button>
                    <button class="filter-btn" onclick="filterARBBackups('manual_save')">Speicherungen</button>
                    <button class="filter-btn" onclick="filterARBBackups('import')">Imports</button>
                    <button class="filter-btn" onclick="filterARBBackups('auto_backup')">Auto-Backups</button>
                </div>
                
                <div id="backupList" class="backup-list">
                    <div class="loading">â³ Lade Backups...</div>
                </div>
                
                <div class="backup-info">
                    <small>ğŸ’¡ Die letzten 15 Backups werden aufbewahrt. Bei Wiederherstellung wird ein Backup der aktuellen Version erstellt.</small>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeBackupDialog()">âŒ SchlieÃŸen</button>
                    <button class="btn-primary" onclick="showARBAuditDialog()" id="arbAuditButton">ğŸ“Š VollstÃ¤ndiger Audit-Trail</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ARB Audit Trail Dialog -->
    <div id="arbAuditDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content audit-dialog">
                <h3>ğŸ“Š ARB-Audit-Trail</h3>
                <p><strong>ğŸŒ Sprache:</strong> <span id="auditLanguageName">-</span></p>
                
                <div class="audit-stats" id="arbAuditStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalARBAuditEntries">-</div>
                        <div class="stat-label">Gesamt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="arbAuditDateRange">-</div>
                        <div class="stat-label">Zeitraum</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="arbAuditKeyChanges">-</div>
                        <div class="stat-label">Key-Ã„nderungen</div>
                    </div>
                </div>
                
                <div id="arbAuditList" class="audit-list">
                    <div class="loading">â³ Lade Audit-Trail...</div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeARBAuditDialog()">âŒ SchlieÃŸen</button>
                    <button class="btn-primary" onclick="exportARBAuditTrail()">ğŸ“¤ Audit-Trail exportieren</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Dialog -->
    <div id="importDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ“¥ ARB-Daten importieren</h3>
                <p>WÃ¤hle eine ARB- oder JSON-Datei zum Importieren:</p>
                
                <div class="import-upload">
                    <input type="file" id="importFileInput" accept=".arb,.json" style="display: none;">
                    <button class="btn-success" onclick="document.getElementById('importFileInput').click()">
                        ğŸ“ Datei auswÃ¤hlen
                    </button>
                    <div id="importFileName" class="import-filename"></div>
                </div>
                
                <div id="importInfo" class="import-info hidden">
                    <strong>Datei-Info:</strong>
                    <ul>
                        <li id="importFileSize">-</li>
                        <li id="importKeyCount">-</li>
                        <li id="importFormat">-</li>
                    </ul>
                </div>
                
                <div id="importError" class="error hidden"></div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeImportDialog()">âŒ Abbrechen</button>
                    <button class="btn-success" id="importPreviewButton" onclick="showImportPreview()" disabled>ğŸ” Vorschau</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Preview Dialog -->
    <div id="importPreviewDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content import-preview-content">
                <h3>ğŸ” Import-Vorschau</h3>
                <p>ÃœberprÃ¼fe die Ã„nderungen vor dem Import:</p>
                
                <div class="import-stats">
                    <div class="stat">
                        <div class="stat-value" id="previewNewCount">0</div>
                        <div class="stat-label">Neue Keys</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="previewUpdateCount">0</div>
                        <div class="stat-label">Aktualisiert</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="previewUnchangedCount">0</div>
                        <div class="stat-label">UnverÃ¤ndert</div>
                    </div>
                </div>
                
                <div class="import-changes">
                    <div id="importPreviewContent" class="preview-content"></div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeImportPreview()">â¬…ï¸ ZurÃ¼ck</button>
                    <button class="btn-success" id="confirmImportButton" onclick="confirmImport()">âœ… Importieren</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Confirmation Dialog -->
    <div id="saveConfirmDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ’¾ ARB-Daten speichern</h3>
                <p><strong>ğŸ“ Sprache:</strong> <span id="saveLanguageDisplay">-</span></p>
                <p><strong>âš ï¸ Wichtiger Hinweis:</strong></p>
                
                <div class="save-warning">
                    <ul>
                        <li>ğŸ“ Die <strong>aktuell geladene ARB-Datei</strong> wird Ã¼berschrieben</li>
                        <li>ğŸ“ Alle Ã„nderungen werden permanent gespeichert</li>
                        <li>ğŸ”„ Ein Backup mit Zeitstempel wird automatisch erstellt</li>
                        <li>âœ… Alle Eingaben werden vor dem Speichern validiert und bereinigt</li>
                    </ul>
                </div>
                
                <div class="save-next-steps">
                    <strong>Nach dem Speichern:</strong>
                    <ol>
                        <li>ğŸ”„ Lade die Seite neu um die Ã„nderungen zu sehen</li>
                        <li>ğŸ“Š Nutze die Vergleichsansicht um andere Sprachen zu Ã¼berprÃ¼fen</li>
                        <li>âœ… Teste die Ã„nderungen in der Flutter-App</li>
                    </ol>
                </div>
                
                <div class="save-stats">
                    <strong>Wird gespeichert:</strong>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="saveKeyCount">-</div>
                            <div class="stat-label">Keys</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="saveChangedCount">-</div>
                            <div class="stat-label">GeÃ¤ndert</div>
                        </div>
                    </div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeSaveConfirmDialog()">âŒ Abbrechen</button>
                    <button class="btn-success" onclick="confirmSave()">âœ… Jetzt speichern</button>
                </div>
            </div>
        </div>
    </div>

    <script src="arb.js"></script>
    
</body>
</html>