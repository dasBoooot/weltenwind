openapi: 3.0.0
info:
  title: Weltenwind Theme API (Modular)
  description: API für modulares Theme-Management mit Meta-Tracking im Weltenwind-System
  version: 2.0.0

paths:
  /api/themes:
    get:
      summary: Liste aller verfügbaren modularen Themes
      description: Lädt alle verfügbaren modularen Themes aus dem schemas-Verzeichnis
      tags:
        - Themes
      responses:
        '200':
          description: Liste der verfügbaren Themes erfolgreich geladen
          content:
            application/json:
              schema:
                type: object
                properties:
                  themes:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Benutzerfreundlicher Theme-Name
                          example: "Default Weltenwind"
                        filename:
                          type: string
                          description: Dateiname ohne Erweiterung
                          example: "default"
                        description:
                          type: string
                          description: Theme-Beschreibung
                          example: "Standard Weltenwind Theme mit mystischer Fantasy-Ästhetik"
                        version:
                          type: string
                          description: Theme-Version (Semantic Versioning)
                          example: "1.0.0"
                        category:
                          type: string
                          description: Theme-Kategorie (fantasy, sci-fi, etc.)
                          example: "fantasy"
        '500':
          description: Serverfehler beim Laden der Theme-Liste
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/themes/{name}:
    get:
      summary: Einzelnes Theme laden
      description: Lädt die vollständigen Daten eines spezifischen Themes
      tags:
        - Themes
      parameters:
        - name: name
          in: path
          required: true
          description: Theme-Name (Dateiname ohne .json)
          schema:
            type: string
            example: "default"
      responses:
        '200':
          description: Theme erfolgreich geladen
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThemeData'
        '404':
          description: Theme nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Serverfehler beim Laden des Themes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Theme speichern
      description: Speichert ein Theme (nur für authentifizierte Benutzer)
      tags:
        - Themes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Theme-Name (Dateiname ohne .json)
          schema:
            type: string
            example: "custom"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ThemeData'
      responses:
        '200':
          description: Theme erfolgreich gespeichert
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Theme erfolgreich gespeichert"
                  theme:
                    type: string
                    example: "custom"
        '400':
          description: Ungültige Theme-Daten
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Nicht authentifiziert
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Keine Berechtigung (Admin erforderlich)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Serverfehler beim Speichern
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/themes/{name}/clone:
    post:
      summary: Theme klonen
      description: Erstellt eine Kopie eines bestehenden Themes mit neuem Namen
      tags:
        - Themes
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Quell-Theme Name
          schema:
            type: string
            example: "default"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newName:
                  type: string
                  description: Name für das neue Theme
                  example: "my-custom-theme"
                newDescription:
                  type: string
                  description: Beschreibung für das neue Theme
                  example: "Mein angepasstes Theme basierend auf Default"
              required:
                - newName
      responses:
        '200':
          description: Theme erfolgreich geklont
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Theme erfolgreich geklont"
                  source:
                    type: string
                    example: "default"
                  target:
                    type: string
                    example: "my-custom-theme"
        '400':
          description: Ungültige Anfrage (newName fehlt)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Nicht authentifiziert
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Quell-Theme nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Ziel-Theme existiert bereits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Serverfehler beim Klonen
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/themes/{name}/backups:
    get:
      summary: Liste aller Backups für ein Theme
      description: Lädt alle verfügbaren Backups mit detaillierten Metadaten für ein spezifisches Theme
      tags:
        - Themes
        - Backups
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Theme-Name
          schema:
            type: string
            example: "tolkien"
      responses:
        '200':
          description: Liste der Theme-Backups mit Metadaten
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  theme:
                    type: string
                    example: "tolkien"
                  backups:
                    type: array
                    items:
                      type: object
                      properties:
                        filename:
                          type: string
                          example: "tolkien.json.backup_2025-08-02_110234"
                        timestamp:
                          type: string
                          example: "2025-08-02_110234"
                        displayName:
                          type: string
                          example: "02.08.2025 um 11:02:34"
                        created:
                          type: string
                          format: date-time
                          example: "2025-08-02T11:02:34.567Z"
                        size:
                          type: number
                          example: 15234
                        createdBy:
                          type: string
                          example: "admin"
                        type:
                          type: string
                          enum: [manual_save, auto_save, pre_restore]
                          example: "manual_save"
                        modulesModified:
                          type: array
                          items:
                            type: string
                            enum: [colors, typography, spacing, radius, gaming, effects, bundle]
                          example: ["colors", "typography"]
                        originalVersion:
                          type: string
                          example: "1.0.0"
                        newVersion:
                          type: string
                          example: "1.1.0"
                        metadata:
                          type: object
                          description: Vollständige Backup-Metadaten
        '403':
          description: Keine Berechtigung für Backup-Anzeige
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Theme nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Serverfehler beim Laden der Backup-Liste
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/themes/{name}/audit:
    get:
      summary: Audit-Trail für ein Theme (Backups + Clone-History)
      description: Lädt den vollständigen Audit-Trail mit allen Theme-Aktivitäten (Speicherungen, Klonungen, etc.)
      tags:
        - Themes
        - Audit
      security:
        - bearerAuth: []
      parameters:
        - name: name
          in: path
          required: true
          description: Theme-Name
          schema:
            type: string
            example: "tolkien"
      responses:
        '200':
          description: Vollständiger Audit-Trail mit allen Theme-Aktivitäten
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  theme:
                    type: string
                    example: "tolkien"
                  auditTrail:
                    type: array
                    items:
                      type: object  
                      properties:
                        action:
                          type: string
                          enum: [manual_save, theme_clone, auto_save, pre_restore]
                          example: "manual_save"
                        themeName:
                          type: string
                          example: "tolkien"
                        timestamp:
                          type: string
                          example: "2025-08-02_110234"
                        createdBy:
                          type: string
                          example: "admin"
                        createdById:
                          type: number
                          example: 1
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-08-02T11:02:34.567Z"
                        type:
                          type: string
                          example: "manual_save"
                        modulesModified:
                          type: array
                          items:
                            type: string
                          example: ["colors", "typography"]
                        originalVersion:
                          type: string
                          example: "1.0.0"
                        newVersion:
                          type: string
                          example: "1.1.0"
                        sourceTheme:
                          type: string
                          description: "Bei Klonungen: Quell-Theme"
                          example: "default"
                        targetTheme:
                          type: string  
                          description: "Bei Klonungen: Ziel-Theme"
                          example: "tolkien"
                        category:
                          type: string
                          example: "fantasy"
                  totalEntries:
                    type: number
                    example: 15
                  oldestEntry:
                    type: string
                    format: date-time
                    example: "2025-07-01T10:00:00.000Z"
                  newestEntry:
                    type: string
                    format: date-time
                    example: "2025-08-02T11:02:34.567Z"
        '403':
          description: Keine Berechtigung für Audit-Trail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Theme nicht gefunden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Serverfehler beim Laden des Audit-Trails
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ThemeData:
      type: object
      description: Vollständige Theme-Definition
      properties:
        name:
          type: string
          description: Theme-Name
          example: "Default Weltenwind"
        version:
          type: string
          description: Semantic Version
          pattern: '^\\d+\\.\\d+\\.\\d+$'
          example: "1.0.0"
        description:
          type: string
          description: Theme-Beschreibung
          example: "Standard Weltenwind Theme mit mystischer Fantasy-Ästhetik"
        colors:
          type: object
          description: Farbdefinitionen
          properties:
            primary:
              $ref: '#/components/schemas/ColorPalette'
            secondary:
              $ref: '#/components/schemas/ColorPalette'
            tertiary:
              $ref: '#/components/schemas/ColorPalette'
            background:
              type: object
              properties:
                surface_dark:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#1E1E2E"
                surface_darker:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#141420"
                surface_medium:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#2A2A3E"
                surface_light:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#3A3A52"
                surface_white:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#F8F9FA"
                surface_gray:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#E9ECEF"
            text:
              type: object
              properties:
                primary:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#E0E0E0"
                secondary:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#B0B0B0"
                tertiary:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#808080"
                disabled:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#505060"
                primary_light:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#1F2937"
                secondary_light:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#6B7280"
            status:
              type: object
              properties:
                success:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#10B981"
                warning:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#F59E0B"
                error:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#EF4444"
                info:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#3B82F6"
            effects:
              type: object
              properties:
                glow:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#9D4EDD"
                shimmer:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{6}$'
                  example: "#FFD700"
                overlay:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{8}$'
                  example: "#80000000"
                glass:
                  type: string
                  pattern: '^#[0-9A-Fa-f]{8}$'
                  example: "#1AFFFFFF"
        radius:
          type: object
          description: Border-Radius Werte
          properties:
            default:
              type: number
              minimum: 0
              example: 12
            small:
              type: number
              minimum: 0
              example: 8
            medium:
              type: number
              minimum: 0
              example: 12
            large:
              type: number
              minimum: 0
              example: 16
            xl:
              type: number
              minimum: 0
              example: 24
        spacing:
          type: object
          description: Spacing/Padding Werte
          properties:
            xs:
              type: number
              minimum: 0
              example: 4
            sm:
              type: number
              minimum: 0
              example: 8
            md:
              type: number
              minimum: 0
              example: 16
            lg:
              type: number
              minimum: 0
              example: 24
            xl:
              type: number
              minimum: 0
              example: 32
            xxl:
              type: number
              minimum: 0
              example: 48
        typography:
          type: object
          description: Typografie-Definitionen
          properties:
            heading:
              $ref: '#/components/schemas/TextStyle'
            body:
              $ref: '#/components/schemas/TextStyle'
            caption:
              $ref: '#/components/schemas/TextStyle'
        shadows:
          type: object
          description: Schatten-Definitionen
          properties:
            small:
              $ref: '#/components/schemas/Shadow'
            medium:
              $ref: '#/components/schemas/Shadow'
            large:
              $ref: '#/components/schemas/Shadow'
      required:
        - name
        - version
        - description
        - colors
        - radius
        - spacing
        - typography
        - shadows

    ColorPalette:
      type: object
      description: Farbpalette mit Varianten
      properties:
        value:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          description: Hauptfarbe
          example: "#4B3B79"
        light:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          description: Helle Variante
          example: "#6A5394"
        dark:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          description: Dunkle Variante
          example: "#2E1F4A"
        surface:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          description: Surface-Variante
          example: "#1A1025"
        accent:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          description: Akzent-Variante
          example: "#7C6BAF"
      required:
        - value
        - light
        - dark

    TextStyle:
      type: object
      description: Typografie-Style Definition
      properties:
        fontSize:
          type: number
          minimum: 8
          description: Schriftgröße in px
          example: 16
        fontWeight:
          type: string
          description: Schriftgewicht
          example: "normal"
        letterSpacing:
          type: number
          description: Buchstabenabstand
          example: 0.4
        lineHeight:
          type: number
          description: Zeilenhöhe
          example: 1.5
      required:
        - fontSize
        - fontWeight

    Shadow:
      type: object
      description: Schatten-Definition
      properties:
        blurRadius:
          type: number
          minimum: 0
          description: Unschärfe-Radius
          example: 4
        spreadRadius:
          type: number
          description: Spread-Radius
          example: 0
        offset:
          type: array
          description: Schatten-Versatz [x, y]
          items:
            type: number
          minItems: 2
          maxItems: 2
          example: [0, 2]
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{8}$'
          description: Schatten-Farbe mit Alpha
          example: "#1A000000"
      required:
        - blurRadius
        - spreadRadius
        - offset
        - color

    ErrorResponse:
      type: object
      description: Standard Fehlerantwort
      properties:
        error:
          type: string
          description: Fehlermeldung
          example: "Theme nicht gefunden"
        message:
          type: string
          description: Detaillierte Fehlermeldung
          example: "Das angeforderte Theme existiert nicht im System"
      required:
        - error

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Token für Authentifizierung

tags:
  - name: Themes
    description: Theme-Management Operationen