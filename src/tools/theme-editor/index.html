<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weltenwind Theme Editor</title>
    <link rel="stylesheet" href="theme-editor.css">
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <h1>ğŸ¨ Weltenwind Theme Editor</h1>
        <p>Admin-Login erforderlich</p>
        <div id="loginError" class="error hidden"></div>
        <form id="loginForm">
            <div>
                <input type="text" id="username" placeholder="Username oder E-Mail" required>
            </div>
            <div>
                <input type="password" id="password" placeholder="Password" required>
            </div>
            <div>
                <button type="submit" id="loginButton">ğŸ”“ Anmelden</button>
            </div>
        </form>
    </div>

    <!-- Theme Editor (hidden initially) -->
    <div id="themeEditor" class="hidden">
        <h1>ğŸ¨ Weltenwind Theme Editor</h1>
        <div style="float: right;">
            <span id="userInfo"></span>
            <button onclick="logout()">ğŸšª Abmelden</button>
        </div>

        <div class="theme-info">
            <h3 id="currentThemeTitle">ğŸ­ Aktuelles Theme</h3>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="themeName">-</div>
                    <div class="stat-label">Theme</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="themeVersion">-</div>
                    <div class="stat-label">Version</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="bundleType">-</div>
                    <div class="stat-label">Bundle Name</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="bundleContext">-</div>
                    <div class="stat-label">Context</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="colorCount">-</div>
                    <div class="stat-label">Farben</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="moduleCount">-</div>
                    <div class="stat-label">Module</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="toolbar">
                <div class="theme-selector">
                    <select id="themeSelector" onchange="loadSelectedTheme()">
                        <option value="">ğŸ¨ Theme wÃ¤hlen...</option>
                    </select>
                    <button type="button" class="btn-secondary" onclick="showCloneDialog()" id="cloneButton" disabled>ğŸ“‹ Klonen</button>
                    <button type="button" class="btn-secondary" onclick="showImportDialog()" id="importButton">ğŸ“¥ Importieren</button>
                </div>
                <div class="actions">
                    <button type="button" class="btn-success" onclick="showSaveConfirmDialog()" id="saveButton" disabled>ğŸ’¾ Speichern</button>
                    <button type="button" class="btn-secondary" onclick="showExportDialog()" id="exportButton" disabled>ğŸ“¤ Export JSON</button>
                    <button type="button" class="btn-secondary" onclick="showBackupDialog()" id="backupButton" disabled>ğŸ“‹ Backups</button>
                    <button type="button" class="btn-secondary" onclick="resetTheme()" id="resetButton" disabled>ğŸ”„ ZurÃ¼cksetzen</button>
                    <button type="button" onclick="togglePreview()" id="previewButton" disabled>ğŸ‘€ Live-Preview</button>
                </div>
            </div>
        </div>

        <!-- Main Editor Layout -->
        <div class="editor-layout">
            <!-- Modular Editor Panel -->
            <div class="editor-panel">
                <h3>ğŸ¨ Theme Module bearbeiten</h3>
                
                <!-- Tab Navigation -->
                <div class="editor-tabs" id="editorTabs">
                    <button class="editor-tab active" data-tab="colors">ğŸ¨ Farben</button>
                    <button class="editor-tab" data-tab="typography">ğŸ“ Typography</button>
                    <button class="editor-tab" data-tab="spacing">ğŸ“ Spacing</button>
                    <button class="editor-tab" data-tab="radius">ğŸ”² Radius</button>
                    <button class="editor-tab" data-tab="gaming">ğŸ® Gaming</button>
                    <button class="editor-tab" data-tab="effects">âœ¨ Effects</button>
                    <button class="editor-tab" data-tab="bundle">ğŸ“¦ Bundle</button>
                </div>
                
                <!-- Tab Content -->
                <div id="editorContent" class="editor-content">
                    <div id="colorEditor" class="color-editor">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>Theme laden...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Preview Panel -->
            <div class="preview-panel" id="previewPanel">
                <h3>ğŸ‘€ Live-Preview</h3>
                <div class="preview-container">
                    <div class="preview-components">
                        <!-- Login Card Preview -->
                        <div class="preview-card" id="loginCardPreview">
                            <h4>Login Card</h4>
                            <div class="preview-login">
                                <input type="text" placeholder="Username" readonly>
                                <input type="password" placeholder="Password" readonly>
                                <button class="preview-btn preview-primary">Anmelden</button>
                            </div>
                        </div>

                        <!-- Button Preview -->
                        <div class="preview-card" id="buttonPreview">
                            <h4>Buttons</h4>
                            <div class="preview-buttons">
                                <button class="preview-btn preview-primary">Primary</button>
                                <button class="preview-btn preview-secondary">Secondary</button>
                                <button class="preview-btn preview-success">Success</button>
                                <button class="preview-btn preview-danger">Error</button>
                            </div>
                        </div>

                        <!-- Card Preview -->
                        <div class="preview-card" id="cardPreview">
                            <h4>Cards & Surfaces</h4>
                            <div class="preview-surface">
                                <p>Surface Dark</p>
                            </div>
                            <div class="preview-surface-light">
                                <p>Surface Light</p>
                            </div>
                        </div>

                        <!-- Typography Preview -->
                        <div class="preview-card" id="typographyPreview">
                            <h4>Typography</h4>
                            <div class="typography-preview">
                                <h1 class="preview-h1">Heading 1 - Fantasy Title</h1>
                                <h2 class="preview-h2">Heading 2 - Chapter</h2>
                                <h3 class="preview-h3">Heading 3 - Section</h3>
                                <p class="preview-body">Body Text - Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum mysticum.</p>
                                <p class="preview-caption">Caption - Small descriptive text</p>
                            </div>
                        </div>

                        <!-- Spacing Preview -->
                        <div class="preview-card" id="spacingPreview">
                            <h4>Spacing & Layout</h4>
                            <div class="spacing-preview">
                                <div class="spacing-demo spacing-xs">XS</div>
                                <div class="spacing-demo spacing-sm">SM</div>
                                <div class="spacing-demo spacing-md">MD</div>
                                <div class="spacing-demo spacing-lg">LG</div>
                                <div class="spacing-demo spacing-xl">XL</div>
                            </div>
                        </div>

                        <!-- Radius Preview -->
                        <div class="preview-card" id="radiusPreview">
                            <h4>Border Radius</h4>
                            <div class="radius-preview">
                                <div class="radius-demo radius-small">Small</div>
                                <div class="radius-demo radius-medium">Medium</div>
                                <div class="radius-demo radius-large">Large</div>
                                <div class="radius-demo radius-xl">XL</div>
                            </div>
                        </div>

                        <!-- Gaming Elements Preview -->
                        <div class="preview-card" id="gamingPreview">
                            <h4>Gaming Elements</h4>
                            <div class="gaming-preview">
                                <!-- Inventory Slots -->
                                <div class="gaming-section">
                                    <h5>Inventory</h5>
                                    <div class="inventory-grid">
                                        <div class="inventory-slot filled">âš”ï¸</div>
                                        <div class="inventory-slot filled">ğŸ›¡ï¸</div>
                                        <div class="inventory-slot filled">ğŸ’</div>
                                        <div class="inventory-slot empty"></div>
                                    </div>
                                </div>
                                
                                <!-- Progress Bars -->
                                <div class="gaming-section">
                                    <h5>Progress</h5>
                                    <div class="progress-bar health">
                                        <div class="progress-fill" style="width: 85%">Health 85%</div>
                                    </div>
                                    <div class="progress-bar mana">
                                        <div class="progress-fill" style="width: 60%">Mana 60%</div>
                                    </div>
                                    <div class="progress-bar experience">
                                        <div class="progress-fill" style="width: 30%">XP 30%</div>
                                    </div>
                                </div>

                                <!-- HUD Elements -->
                                <div class="gaming-section">
                                    <h5>HUD Elements</h5>
                                    <div class="hud-element">
                                        <span class="hud-label">Gold:</span>
                                        <span class="hud-value">1,247</span>
                                    </div>
                                    <div class="hud-element">
                                        <span class="hud-label">Level:</span>
                                        <span class="hud-value">42</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Effects Preview -->
                        <div class="preview-card" id="effectsPreview">
                            <h4>Visual Effects</h4>
                            <div class="effects-preview">
                                <div class="effect-demo glow-effect">Glow Effect</div>
                                <div class="effect-demo shimmer-effect">Shimmer Effect</div>
                                <div class="effect-demo glass-effect">Glass Effect</div>
                                <div class="effect-demo pulse-effect">Pulse Animation</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="themeMessage" class="hidden"></div>
    </div>

    <!-- Clone Dialog -->
    <div id="cloneDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ“‹ Theme klonen</h3>
                <p>Erstelle eine Kopie von <strong id="cloneSourceName">-</strong>:</p>
                
                <div class="clone-form">
                    <div>
                        <label for="cloneNewName">Neuer Name:</label>
                        <input type="text" id="cloneNewName" placeholder="z.B. 'Mein Custom Theme'">
                    </div>
                    <div>
                        <label for="cloneNewDescription">Beschreibung:</label>
                        <textarea id="cloneNewDescription" placeholder="Beschreibung des neuen Themes..."></textarea>
                    </div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeCloneDialog()">âŒ Abbrechen</button>
                    <button class="btn-success" onclick="confirmClone()" id="confirmCloneButton">ğŸ“‹ Klonen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Dialog -->
    <div id="exportDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ“¤ Theme exportieren</h3>
                <p>Theme als JSON-Datei herunterladen:</p>
                
                <div class="export-info">
                    <strong>Exportiert werden:</strong>
                    <ul>
                        <li>Alle Farbdefinitionen</li>
                        <li>Spacing & Radius Werte</li>
                        <li>Typografie-Einstellungen</li>
                        <li>Schatten-Definitionen</li>
                        <li>Theme-Metadaten</li>
                    </ul>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeExportDialog()">âŒ Abbrechen</button>
                    <button class="btn-success" onclick="exportTheme()">ğŸ“¤ JSON Download</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Save Confirmation Dialog -->
    <div id="saveConfirmDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ’¾ Theme speichern</h3>
                <p><strong>ğŸ¨ Theme:</strong> <span id="saveThemeDisplay">-</span></p>
                <p><strong>âš ï¸ Wichtiger Hinweis:</strong></p>
                
                <div class="save-warning">
                    <ul>
                        <li>ğŸ¨ Das <strong>aktuelle Theme</strong> wird Ã¼berschrieben</li>
                        <li>ğŸ’¾ Alle Ã„nderungen werden permanent gespeichert</li>
                        <li>ğŸ”„ Ein Backup wird automatisch erstellt</li>
                        <li>âœ… Das Theme wird fÃ¼r die Flutter-App verfÃ¼gbar</li>
                    </ul>
                </div>
                
                <div class="save-next-steps">
                    <strong>Nach dem Speichern:</strong>
                    <ol>
                        <li>ğŸ”„ Lade die Seite neu um die Ã„nderungen zu sehen</li>
                        <li>ğŸ® Teste das Theme in der Flutter-App</li>
                        <li>ğŸ“± ÃœberprÃ¼fe die Darstellung auf verschiedenen GerÃ¤ten</li>
                    </ol>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeSaveConfirmDialog()">âŒ Abbrechen</button>
                    <button class="btn-success" onclick="confirmSave()">âœ… Jetzt speichern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Management Dialog -->
    <div id="backupDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content backup-dialog">
                <h3>ğŸ’¾ Theme-Backup-Historie</h3>
                <p><strong>ğŸ¨ Theme:</strong> <span id="backupThemeName">-</span></p>
                
                <div class="backup-filters">
                    <button class="filter-btn active" onclick="filterBackups('all')">Alle</button>
                    <button class="filter-btn" onclick="filterBackups('manual_save')">Speicherungen</button>
                    <button class="filter-btn" onclick="filterBackups('theme_clone')">Klonungen</button>
                </div>
                
                <div id="backupList" class="backup-list">
                    <div class="loading">â³ Lade Backups...</div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeBackupDialog()">âŒ SchlieÃŸen</button>
                    <button class="btn-primary" onclick="showAuditDialog()" id="auditButton">ğŸ“Š VollstÃ¤ndiger Audit-Trail</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audit Trail Dialog -->
    <div id="auditDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content audit-dialog">
                <h3>ğŸ“Š Theme-Audit-Trail</h3>
                <p><strong>ğŸ¨ Theme:</strong> <span id="auditThemeName">-</span></p>
                
                <div class="audit-stats" id="auditStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalAuditEntries">-</div>
                        <div class="stat-label">Gesamt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="auditDateRange">-</div>
                        <div class="stat-label">Zeitraum</div>
                    </div>
                </div>
                
                <div id="auditList" class="audit-list">
                    <div class="loading">â³ Lade Audit-Trail...</div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeAuditDialog()">âŒ SchlieÃŸen</button>
                    <button class="btn-primary" onclick="exportAuditTrail()">ğŸ“¤ Audit-Trail exportieren</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Theme Dialog -->
    <div id="importDialog" class="hidden">
        <div class="dialog-overlay">
            <div class="dialog-content">
                <h3>ğŸ“¥ Theme importieren</h3>
                <p>Importiere ein Theme aus einer JSON-Datei oder fÃ¼ge JSON-Code direkt ein.</p>
                
                <div class="import-mode-selection">
                    <h4>ğŸ¯ Import-Modus</h4>
                    <div class="import-mode-options">
                        <label class="import-mode-option">
                            <input type="radio" name="importMode" value="new" checked onchange="toggleImportMode()">
                            <span>ğŸ“ Neues Theme erstellen</span>
                        </label>
                        <label class="import-mode-option">
                            <input type="radio" name="importMode" value="update" onchange="toggleImportMode()">
                            <span>ğŸ”„ Bestehendes Theme aktualisieren</span>
                        </label>
                    </div>
                    
                    <div id="existingThemeSelector" class="existing-theme-selector hidden">
                        <label for="targetTheme">ğŸ¨ Ziel-Theme auswÃ¤hlen:</label>
                        <select id="targetTheme" style="width: 100%; margin-top: 5px;">
                            <option value="">Theme auswÃ¤hlen...</option>
                        </select>
                        <p class="import-note">âš ï¸ Bundle-Konfiguration wird beibehalten, nur Inhalte werden aktualisiert</p>
                    </div>
                </div>

                <div class="import-options">
                    <div class="import-method">
                        <h4>ğŸ“„ Datei hochladen</h4>
                        <input type="file" id="importFile" accept=".json" style="width: 100%; margin-bottom: 10px;">
                        <button class="btn-secondary" onclick="loadFileContent()" style="width: 100%;">ğŸ“‚ Datei laden</button>
                    </div>
                    
                    <div class="import-divider">
                        <span>oder</span>
                    </div>
                    
                    <div class="import-method">
                        <h4>ğŸ“ JSON-Code einfÃ¼gen</h4>
                        <textarea id="importJson" placeholder='{\n  "name": "Mein Theme",\n  "version": "1.0.0",\n  ...\n}' rows="8" style="width: 100%; font-family: monospace; resize: vertical;"></textarea>
                    </div>
                </div>
                
                <div id="importValidation" class="import-validation hidden">
                    <h4>âœ… Validierung</h4>
                    <div id="validationResults"></div>
                </div>
                
                <div class="dialog-buttons">
                    <button class="btn-secondary" onclick="closeImportDialog()">âŒ Abbrechen</button>
                    <button class="btn-primary" onclick="validateImport()" id="validateButton">ğŸ” Validieren</button>
                    <button class="btn-success" onclick="executeImport()" id="importExecuteButton" disabled>ğŸ“¥ Importieren</button>
                </div>
            </div>
        </div>
    </div>

    <script src="theme-editor.js"></script>
</body>
</html>